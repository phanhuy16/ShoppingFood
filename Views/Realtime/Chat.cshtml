@{
	ViewData["Title"] = "Chat Page";
}

<!-- Single Page Header start -->
<div class="container-fluid page-header py-5 bg-primary text-white">
	<h1 class="text-center display-6">Live Chat</h1>
	<ol class="breadcrumb justify-content-center mb-0">
		<li class="breadcrumb-item"><a href="#" class="text-white text-decoration-none">Home</a></li>
		<li class="breadcrumb-item"><a href="#" class="text-white text-decoration-none">Pages</a></li>
		<li class="breadcrumb-item active text-white">Chat</li>
	</ol>
</div>
<!-- Single Page Header End -->

<div class="container py-5">
	<div class="row justify-content-center">
		<div class="col-md-8">
			<div class="card shadow-lg">
				<div class="card-header bg-primary text-white text-center">
					<h4>Real-Time Chat</h4>
				</div>
				<div class="card-body">
					<input type="hidden" id="userIdInput" /> <!-- Lưu ID của client -->
					<div class="input-group mb-3">
						<input type="text" id="messageInput" class="form-control" placeholder="Nhập tin nhắn..." />
						<button id="sendButton" class="btn btn-primary">Gửi</button>
					</div>
					<div id="messagesList" class="border p-3" style="height: 300px; overflow-y: auto;"></div>
				</div>
			</div>
		</div>
	</div>
</div>


@section Scripts {
	<script>
		"use strict";

		const connection = new signalR.HubConnectionBuilder()
			.withUrl("/chatHub")
			.build();

		let userId = "";

		connection.on("SetUserId", function (id) {
			userId = id;
		});

		connection.on("ReceiveAdminMessage", function (message) {
			const msg = document.createElement("div");
			msg.textContent = `Admin: ${message}`;
			msg.classList.add("alert", "alert-primary");
			document.getElementById("messagesList").appendChild(msg);
			messagesList.scrollTop = messagesList.scrollHeight;
		});

		document.getElementById("sendButton").addEventListener("click", function (event) {
			const message = document.getElementById("messageInput").value;
			if (!message.trim()) return;

			connection.invoke("SendMessageToAdmin", userId, message)
				.catch(function (err) {
					console.error(err.toString());
				});

			const msg = document.createElement("div");
			msg.textContent = `Me: ${message}`;
			msg.classList.add("alert", "alert-success");
			document.getElementById("messagesList").appendChild(msg);
			document.getElementById("messageInput").value = "";
			messagesList.scrollTop = messagesList.scrollHeight;

			event.preventDefault();
		});

		connection.start().then(function () {
			document.getElementById("sendButton").disabled = false;
		}).catch(function (err) {
			console.error("SignalR connection failed: ", err.toString());
		});
	</script>
}