@model ShoppingFood.Models.ViewModel.CartItemViewModel
@{
	ViewData["Title"] = "CheckOut Page";
}

<!-- Single Page Header start -->
<div class="container-fluid page-header py-5">
	<h1 class="text-center text-white display-6">Checkout</h1>
	<ol class="breadcrumb justify-content-center mb-0">
		<li class="breadcrumb-item"><a href="#">Home</a></li>
		<li class="breadcrumb-item"><a href="#">Pages</a></li>
		<li class="breadcrumb-item active text-white">Checkout</li>
	</ol>
</div>
<!-- Single Page Header End -->
<!-- Checkout Page Start -->
<div class="container-fluid py-5">
	<div class="container py-5">
		<h1 class="mb-4">Billing details</h1>
		<div class="row g-5">
			@{
				var user = ViewBag.User as AppUserModel;
			}
			<div class="col-md-12 col-lg-6 col-xl-7">
				<div class="form-item">
					<label class="form-label my-3">Full Name<sup>*</sup></label>
					<input type="text" value="@user.UserName" class="form-control">
				</div>
				<div class="form-item">
					<label class="form-label my-3">Address <sup>*</sup></label>
					<input type="text" class="form-control" placeholder="House Number Street Name">
				</div>
				<div class="form-item">
					<label class="form-label my-3">Mobile<sup>*</sup></label>
					<input type="tel" value="@user.PhoneNumber" class="form-control">
				</div>
				<div class="form-item">
					<label class="form-label my-3">Email Address<sup>*</sup></label>
					<input type="email" value="@user.Email" class="form-control">
				</div>
				<div class="form-item mt-4">
					<textarea name="text" class="form-control" spellcheck="false" cols="30" rows="11" placeholder="Oreder Notes (Optional)"></textarea>
				</div>
			</div>

			<div class="col-md-12 col-lg-6 col-xl-5">
				<div class="table-responsive">
					<table class="table">
						<thead>
							<tr>
								<th scope="col">Products</th>
								<th scope="col">Name</th>
								<th scope="col">Price</th>
								<th scope="col">Quantity</th>
								<th scope="col">Total</th>
							</tr>
						</thead>
						<tbody>
							@foreach (var item in Model.CartItems)
							{
								<tr>
									<th scope="row">
										<div class="d-flex align-items-center mt-2">
											<img src="~/media/products/@item.Image" class="img-fluid me-5 rounded-circle" style="width: 80px; height: 80px;" alt="">
										</div>
									</th>
									<td class="py-5">@item.ProductName</td>
									<td class="py-5">@item.Price.ToString("#,##0 VND")</td>
									<td class="py-5">@item.Quantity</td>
									<td class="py-5">@Model.CartItems.Where(x => x.ProductId == item.ProductId).Sum(x => x.Quantity * x.Price).ToString("#,##0 VND")</td>
								</tr>
							}
							<tr>
								<th scope="row">
								</th>
								<td class="py-5"></td>
								<td class="py-5"></td>
								<td class="py-5">
									<p class="mb-0 text-dark py-3">Subtotal</p>
								</td>
								<td class="py-5">
									<div class="py-3 border-bottom border-top">
										<p class="mb-0 text-dark">@Model.GrandTotal.ToString("#,##0 VND")</p>
									</div>
								</td>
							</tr>
							<tr>
								<th scope="row">
								</th>
								<td class="py-5">
									<p class="mb-0 text-dark text-uppercase py-3">TOTAL</p>
								</td>
								<td class="py-5"></td>
								<td class="py-5"></td>
								<td class="py-5">
									<div class="py-3 border-bottom border-top">
										@{
											var total = Model.GrandTotal + Model.ShippingCost;
										}
										<p class="mb-0 text-dark">@total.ToString("#,##0 VND")</p>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="row g-4 text-center align-items-center justify-content-center border-bottom py-3">
					<div class="col-12">
						<div class="form-check text-start my-3">
							<input type="checkbox" checked class="form-check-input bg-primary border-0 check-cod" id="Delivery-1" name="Delivery" value="Delivery">
							<label class="form-check-label" for="Delivery-1">Cash On Delivery</label>
						</div>
					</div>
				</div>
				<div class="row g-4 text-center align-items-center justify-content-center border-bottom py-3">
					<div class="col-12">
						<div class="form-check text-start my-3">
							<input type="checkbox" class="form-check-input bg-primary border-0 check-momo" id="Momo-1" name="Momo" value="Momo">
							<label class="form-check-label" for="Momo-1"> Momo</label>
						</div>
					</div>
				</div>
				<div class="row g-4 text-center align-items-center justify-content-center border-bottom py-3">
					<div class="col-12">
						<div class="form-check text-start my-3">
							<input type="checkbox" class="form-check-input bg-primary border-0 check-vnpay" id="VnPay-1" name="VnPay" value="VnPay">
							<label class="form-check-label" for="VnPay-1"> VnPay</label>
						</div>
					</div>
				</div>
				<div class="row g-4 text-center align-items-center justify-content-center pt-4" id="momo">
					<form asp-action="PaymentMomo" asp-controller="Payment" method="post">
						<input type="hidden" name="Amount" value="@Model.GrandTotal" />
						<input type="hidden" name="OrderInfo" value="Thanh toán Momo cho đơn hàng tại ShoppingFood" />
						<input type="hidden" name="FullName" value="@User.Identity.Name" />
						<button type="submit" name="PayUrl" class="btn border-secondary py-3 px-4 text-uppercase w-100 text-primary">Thanh toán Momo</button>
					</form>
				</div>
				<div class="row g-4 text-center align-items-center justify-content-center pt-4" id="cod">
					<form asp-action="CheckOut" asp-controller="Cart" method="post">

						<button type="submit" class="btn border-secondary py-3 px-4 text-uppercase w-100 text-primary">Thanh toán</button>
					</form>
				</div>

				<div class="row g-4 text-center align-items-center justify-content-center pt-4" id="vnpay">
					<form asp-action="PaymentVnPay" asp-controller="Payment" method="post">
						<input type="hidden" name="Name" value="@User.Identity.Name" />
						<input type="hidden" name="Amount" value="@Model.GrandTotal" />
						<input type="hidden" name="OrderDescription" value="Thanh toán VnPay cho đơn hàng tại ShoppingFood là" />
						<input type="hidden" name="OrderType" value="other" />

						<button type="submit" class="btn border-secondary py-3 px-4 text-uppercase w-100 text-primary">Thanh toán VnPay</button>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Checkout Page End -->
@section Scripts {
	<script>
		$(document).ready(function () {
			function updatePaymentMethod(selected) {
				// Bỏ chọn tất cả checkbox
				$('.form-check-input').prop('checked', false);

				// Hiển thị đúng form theo phương thức thanh toán
				$('#vnpay, #cod, #momo').hide();
				if (selected === 'vnpay') {
					$('.check-vnpay').prop('checked', true);
					$('#vnpay').show();
				} else if (selected === 'momo') {
					$('.check-momo').prop('checked', true);
					$('#momo').show();
				} else {
					$('.check-cod').prop('checked', true);
					$('#cod').show();
				}
			}

			// Khi trang tải, mặc định chọn COD
			updatePaymentMethod('cod');

			// Xử lý khi chọn checkbox
			$('.form-check-input').change(function () {
				if ($(this).is(':checked')) {
					let paymentMethod = $(this).val().toLowerCase();
					updatePaymentMethod(paymentMethod);
				}
			});
		});

	</script>
}